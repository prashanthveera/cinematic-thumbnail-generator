<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Cinematic Thumbnail Generator</title>
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap');
    body {
      font-family: 'Inter', sans-serif;
      background-color: #0d1117;
      color: #c9d1d9;
    }
    .app-container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 20px;
    }
    .thumbnail-box {
      background-color: #161b22;
      border: 2px solid #30363d;
      aspect-ratio: 16/9;
      position: relative;
    }
    .loading-spinner {
      border: 4px solid rgba(255,255,255,0.1);
      border-top: 4px solid #58a6ff;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
    }
    @keyframes spin {
      0% { transform: rotate(0deg);}
      100% { transform: rotate(360deg);}
    }
    .download-btn {
      opacity: 0;
      transition: opacity 0.3s;
    }
    .thumbnail-box:hover .download-btn {
      opacity: 1;
    }
  </style>
</head>

<body>

<div class="app-container">
  <header class="text-center py-6 border-b border-gray-700 mb-6">
    <h1 class="text-4xl font-extrabold text-blue-400">
      Cinematic Thumbnail Generator
    </h1>
    <p class="text-gray-400 mt-2">
      Create 4 cinematic thumbnails using AI
    </p>
  </header>

  <main class="space-y-8">

    <!-- Prompt Panel -->
    <div class="bg-[#161b22] p-6 rounded-xl shadow-lg border border-[#30363d]">
      <h2 class="text-2xl font-semibold mb-3 text-white">1. Enter Prompt</h2>

      <textarea
        id="promptInput"
        rows="5"
        class="w-full p-4 rounded-lg bg-[#0d1117] border border-gray-600 text-sm"
        placeholder="Describe your thumbnail…"
      ></textarea>

      <button
        onclick="generateThumbnails()"
        id="generateBtn"
        class="w-full mt-4 bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-4 rounded-lg transition">
        Generate 4 Thumbnails
      </button>

      <p id="messageBox" class="mt-4 text-sm min-h-[1.5rem]"></p>
    </div>

    <!-- Results -->
    <div class="bg-[#161b22] p-6 rounded-xl shadow-lg border border-[#30363d]">
      <h2 class="text-2xl font-semibold text-white mb-4">2. Results (16:9)</h2>

      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">

        <!-- dynamic thumbnails -->
        <script>
          document.write(
            Array.from({ length: 4 })
              .map(
                (_, i) => `
                  <div class="space-y-2">
                    <div id="area${i+1}" class="thumbnail-box flex items-center justify-center rounded-lg overflow-hidden">
                      <img id="img${i+1}" class="hidden w-full h-full object-cover" />
                      <div id="placeholder${i+1}" class="text-gray-500">Thumbnail ${i+1}</div>
                      <div id="spinner${i+1}" class="hidden loading-spinner"></div>
                      <button onclick="downloadImage(${i+1})" class="download-btn hidden absolute top-2 right-2 bg-blue-600 text-white py-2 px-4 rounded-lg">Download</button>
                    </div>
                  </div>
                `
              )
              .join("")
          );
        </script>

      </div>
    </div>
  </main>
</div>

<script>
/* ✅ Backend function endpoint */
const FUNCTION_URL = "/.netlify/functions/imagen";

let generatedImages = [];

/* Generate ALL 4 */
async function generateThumbnails() {
  const prompt = document.getElementById("promptInput").value.trim();
  const msg = document.getElementById("messageBox");

  msg.textContent = "Generating… (This may take 10–25 seconds)";
  msg.className = "text-yellow-400";

  if (!prompt) {
    msg.textContent = "Please enter a prompt!";
    msg.className = "text-red-400";
    return;
  }

  generatedImages = [];
  await Promise.all([
    generateOne(1, prompt),
    generateOne(2, prompt),
    generateOne(3, prompt),
    generateOne(4, prompt),
  ]);

  msg.textContent = "✅ Done!";
  msg.className = "text-green-400";
}

/* Generate each thumbnail */
async function generateOne(id, prompt) {
  const img = document.getElementById("img" + id);
  const placeholder = document.getElementById("placeholder" + id);
  const spinner = document.getElementById("spinner" + id);
  const downloadBtn = document.querySelector(`#area${id} .download-btn`);

  img.classList.add("hidden");
  placeholder.classList.add("hidden");
  spinner.classList.remove("hidden");
  downloadBtn.classList.add("hidden");

  try {
    const res = await fetch(FUNCTION_URL, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ prompt }),
    });

    const data = await res.json();

console.log("IMAGE API RESPONSE:", data);   // ✅ LOG FULL RESPONSE

if (!data?.images?.length) {
  throw new Error(JSON.stringify(data));
}


    const b64 = data.images[0];
    const url = `data:image/png;base64,${b64}`;

    img.src = url;
    img.classList.remove("hidden");
    downloadBtn.classList.remove("hidden");

    generatedImages[id - 1] = url;
  } catch (e) {
    console.log(e);
    placeholder.textContent = "Error";
    placeholder.classList.remove("hidden");
  }

  spinner.classList.add("hidden");
}

/* Download */
function downloadImage(id) {
  const url = generatedImages[id - 1];
  if (!url) return;
  const a = document.createElement("a");
  a.href = url;
  a.download = "thumbnail-" + id + ".png";
  a.click();
}
</script>


</body>
</html>


